{"version":3,"sources":["../../src/components/graph-view.js"],"names":["d3","styleToString","style","Object","keys","map","k","key","replace","toLowerCase","join","makeStyles","primary","light","dark","background","styles","wrapper","base","height","margin","display","boxShadow","opacity","transition","focused","svg","alignContent","flex","node","color","stroke","fill","filter","strokeWidth","cursor","selected","shape","text","edge","markerEnd","arrow","baseString","selectedString","getTheta","pt1","pt2","xComp","x","yComp","y","theta","Math","atan2","getMidpoint","getDistance","sqrt","pow","GraphView","props","hideEdge","edgeDOMNode","select","attr","showEdge","canSwap","sourceNode","hoveredNode","swapEdge","source","nodeKey","target","lineFunction","data","line","d","drawEdge","swapErrBack","self","dragEdge","entities","append","state","event","on","dragged","ended","remove","edgeSwapQueue","shift","setState","drawingEdge","canCreateEdge","canDeleteEdge","onSwapEdge","renderView","onCreateEdge","dragNode","el","parentElement","classed","oldSibling","readOnly","selectedNode","nextSibling","appendChild","dx","dy","render","datum","insertBefore","onUpdateNode","dispatchEvent","Event","handleNodeDrag","subject","handleDelete","canDeleteNode","onDeleteNode","onSelectNode","onDeleteEdge","handleWrapperKeydown","i","handleSvgClicked","isPartOfEdge","selectingNode","shiftKey","xycoords","mouse","onCreateNode","element","viewWrapper","classList","contains","handleNodeMouseDown","defaultPrevented","preventDefault","stopPropagation","document","activeElement","focus","previousSelection","handleNodeMouseUp","handleNodeMouseEnter","handleNodeMouseLeave","fromMouseup","which","arrowClicked","tagName","getViewNode","dist","nodeSize","edgeArrowSize","handleEdgeDrag","bind","handleEdgeMouseDown","push","onSelectEdge","containZoom","handleZoom","viewTransform","transform","handleZoomToFit","parent","viewBBox","getBBox","width","clientWidth","clientHeight","translate","next","max","minZoom","maxZoom","setZoom","zoomDur","modifyZoom","modK","modX","modY","dur","target_zoom","center","extent","zoom","scaleExtent","translate0","l","t","zoomIdentity","scale","duration","call","getPathDescriptionStr","sourceX","sourceY","targetX","targetY","getPathDescription","src","trg","off","xOff","cos","yOff","sin","console","warn","getEdgeHandleTransformation","origin","PI","offset","edgeHandleSize","getNodeTransformation","getNodeStyle","getEdgeStyle","getTextStyle","wrap","log","each","words","split","reverse","word","lineNumber","lineHeight","tspan","pop","getComputedTextLength","renderNodeText","domNode","d3Node","title","titleText","length","maxTitleChars","substring","selectAll","typeText","nodeTypes","type","renderEdges","edges","exit","newEdges","enter","drag","transitionTime","merge","updateEdge","els","edgeTimeouts","clearTimeout","setTimeout","renderEdge","renderNodes","nodes","overlap","nodeKeyWarned","nodesSelection","undefined","removedNodes","newNodes","updateNode","nodeTimeouts","renderNode","newState","isInSelected","sd","size","isInNewNodes","nd","isInRemovedNodes","rd","view","selectionChanged","enableFocus","process","env","NODE_ENV","zoomDelay","nextProps","selectionType","prevProps","prevState","renderDefs","renderBackground","graphControls","Component","propTypes","PropTypes","string","isRequired","emptyType","array","object","nodeSubtypes","edgeTypes","func","bool","number","gridSize","gridSpacing","gridDot","defaultProps","graphView","index","elements","hasChildNodes","trans","shapeId","selection","subtype","defIndex","graphConfigDefs","forEach","React","cloneElement"],"mappings":"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","file":"graph-view.js","sourcesContent":["// Copyright (c) 2016 Uber Technologies, Inc.\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the \"Software\"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n// THE SOFTWARE.\r\n\r\n/*\r\n  GraphView is a Generic D3 Graph view with no application specific\r\n  code in it and no significant state except UI state (zoom, for example).\r\n*/\r\n\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as d3 from 'd3';\r\nimport Radium from 'radium';\r\nimport GraphControls from './graph-controls.js';\r\n\r\nfunction styleToString(style) {\r\n  return Object.keys(style)\r\n    .map(function(k) {\r\n      let key = k.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\r\n      return `${key}:${style[k]}`;\r\n    })\r\n    .join(';');\r\n}\r\n\r\nfunction makeStyles(\r\n  primary = 'dodgerblue',\r\n  light = 'white',\r\n  dark = 'black',\r\n  background = '#F9F9F9'\r\n) {\r\n  let styles = {\r\n    wrapper: {\r\n      base: {\r\n        height: '100%',\r\n        margin: 0,\r\n        display: 'flex',\r\n        boxShadow: 'none',\r\n        opacity: 0.5,\r\n        background: background,\r\n        transition: 'opacity 0.167s',\r\n      },\r\n      focused: {\r\n        opacity: 1,\r\n      },\r\n    },\r\n    svg: {\r\n      base: {\r\n        alignContent: 'stretch',\r\n        flex: 1,\r\n      },\r\n    },\r\n    node: {\r\n      base: {\r\n        color: primary,\r\n        stroke: light,\r\n        fill: light,\r\n        filter: 'url(#dropshadow)',\r\n        strokeWidth: '0.5px',\r\n        cursor: 'pointer',\r\n      },\r\n      selected: {\r\n        color: light,\r\n        stroke: primary,\r\n        fill: primary,\r\n      },\r\n    },\r\n    shape: {\r\n      fill: 'inherit',\r\n      stroke: dark,\r\n      strokeWidth: '0.5px',\r\n    },\r\n    text: {\r\n      base: {\r\n        fill: dark,\r\n        stroke: dark,\r\n      },\r\n      selected: {\r\n        fill: light,\r\n        stroke: light,\r\n      },\r\n    },\r\n    edge: {\r\n      base: {\r\n        color: light,\r\n        stroke: primary,\r\n        strokeWidth: '2px',\r\n        markerEnd: 'url(#end-arrow)',\r\n        cursor: 'pointer',\r\n      },\r\n      selected: {\r\n        color: primary,\r\n        stroke: primary,\r\n      },\r\n    },\r\n    arrow: {\r\n      fill: primary,\r\n    },\r\n  };\r\n\r\n  // Styles need to be strings for D3 to apply them all at once\r\n  styles.node.baseString = styleToString(styles.node.base);\r\n  styles.node.selectedString = styleToString({ ...styles.node.base, ...styles.node.selected });\r\n  styles.text.baseString = styleToString(styles.text.base);\r\n  styles.text.selectedString = styleToString({ ...styles.text.base, ...styles.text.selected });\r\n  styles.edge.baseString = styleToString(styles.edge.base);\r\n  styles.edge.selectedString = styleToString({ ...styles.edge.base, ...styles.edge.selected });\r\n\r\n  return styles;\r\n}\r\n\r\n// any objects with x & y properties\r\nfunction getTheta(pt1, pt2) {\r\n  const xComp = pt2.x - pt1.x;\r\n  const yComp = pt2.y - pt1.y;\r\n  const theta = Math.atan2(yComp, xComp);\r\n  return theta;\r\n}\r\n\r\nfunction getMidpoint(pt1, pt2) {\r\n  const x = (pt2.x + pt1.x) / 2;\r\n  const y = (pt2.y + pt1.y) / 2;\r\n\r\n  return { x: x, y: y };\r\n}\r\n\r\nfunction getDistance(pt1, pt2) {\r\n  return Math.sqrt(Math.pow(pt2.x - pt1.x, 2) + Math.pow(pt2.y - pt1.y, 2));\r\n}\r\n\r\nclass GraphView extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      viewTransform: d3.zoomIdentity,\r\n      selectionChanged: false,\r\n      focused: true,\r\n      enableFocus: props.enableFocus || false, // Enables focus/unfocus\r\n      edgeSwapQueue: [], // Stores nodes to be swapped\r\n      styles: makeStyles(props.primary, props.light, props.dark, props.background),\r\n    };\r\n\r\n    this.zoom = d3\r\n      .zoom()\r\n      .scaleExtent([props.minZoom, props.maxZoom])\r\n      .on('zoom', this.handleZoom);\r\n\r\n    this.nodeTimeouts = {};\r\n    this.edgeTimeouts = {};\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Window event listeners for keypresses\r\n    // and to control blur/focus of graph\r\n    d3.select(this.viewWrapper).on('keydown', this.handleWrapperKeydown);\r\n\r\n    var svg = d3\r\n      .select(this.viewWrapper)\r\n      .on('touchstart', this.containZoom)\r\n      .on('touchmove', this.containZoom)\r\n      .on('click', this.handleSvgClicked)\r\n      .select('svg')\r\n      .call(this.zoom);\r\n\r\n    // On the initial load, the 'view' <g> doesn't exist\r\n    // until componentDidMount. Manually render the first view.\r\n    this.renderView();\r\n\r\n    // It seems Electron/JSDom's mocking of the SVG API is incomplete\r\n    // and causes D3 to error out when zooming to fit in tests.\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      setTimeout(() => {\r\n        if (this.viewWrapper != null) {\r\n          this.handleZoomToFit();\r\n        }\r\n      }, this.props.zoomDelay);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    // Remove window event listeners\r\n    d3.select(this.viewWrapper).on('keydown', null);\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    let selectionChanged = false;\r\n    let selected = this.props.selected;\r\n    const newState = {};\r\n\r\n    if (nextProps.selected !== selected) {\r\n      newState.selected = nextProps.selected;\r\n      newState.previousSelection = selected;\r\n      newState.selectionChanged = true;\r\n\r\n      let selectionType = null;\r\n      if (nextProps.selected && nextProps.selected.source) {\r\n        newState.selectionType = 'edge';\r\n      } else if (nextProps.selected && nextProps.selected[this.props.nodeKey]) {\r\n        newState.selectionType = 'node';\r\n      }\r\n\r\n      this.setState(newState);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (this.state.selectionChanged) {\r\n      this.setState({\r\n        selectionChanged: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Handlers/Interaction\r\n   */\r\n\r\n  hideEdge = (edgeDOMNode) => {\r\n    d3.select(edgeDOMNode).attr('opacity', 0);\r\n  };\r\n\r\n  showEdge = (edgeDOMNode) => {\r\n    d3.select(edgeDOMNode).attr('opacity', 1);\r\n  };\r\n\r\n  canSwap = (sourceNode, hoveredNode, swapEdge) => {\r\n    return (\r\n      swapEdge.source != sourceNode[this.props.nodeKey] ||\r\n      swapEdge.target != hoveredNode[this.props.nodeKey]\r\n    );\r\n  };\r\n\r\n  lineFunction = (data) => {\r\n    // Provides API for curved lines using .curve()\r\n    // Example: https://bl.ocks.org/d3indepth/64be9fc39a92ef074034e9a8fb29dcce\r\n    return d3\r\n      .line()\r\n      .x(function(d) {\r\n        return d.x;\r\n      })\r\n      .y(function(d) {\r\n        return d.y;\r\n      })(data);\r\n  };\r\n\r\n  drawEdge = (sourceNode, target, swapErrBack) => {\r\n    const self = this;\r\n\r\n    const dragEdge = d3.select(this.entities).append('svg:path');\r\n\r\n    dragEdge\r\n      .attr('class', 'link dragline')\r\n      .attr('style', this.state.styles.edge.selectedString)\r\n      .attr(\r\n        'd',\r\n        this.lineFunction([{ x: sourceNode.x, y: sourceNode.y }, { x: d3.event.x, y: d3.event.y }])\r\n      );\r\n\r\n    d3.event.on('drag', dragged).on('end', ended);\r\n\r\n    function dragged(d) {\r\n      dragEdge.attr(\r\n        'd',\r\n        self.lineFunction([{ x: sourceNode.x, y: sourceNode.y }, { x: d3.event.x, y: d3.event.y }])\r\n      );\r\n    }\r\n\r\n    function ended(d) {\r\n      dragEdge.remove();\r\n\r\n      let swapEdge = self.state.edgeSwapQueue.shift();\r\n      let hoveredNode = self.state.hoveredNode;\r\n\r\n      self.setState({\r\n        edgeSwapQueue: self.state.edgeSwapQueue,\r\n        drawingEdge: false,\r\n      });\r\n\r\n      if (hoveredNode && self.props.canCreateEdge(sourceNode, hoveredNode)) {\r\n        if (swapEdge) {\r\n          if (\r\n            self.props.canDeleteEdge(swapEdge) &&\r\n            self.canSwap(sourceNode, hoveredNode, swapEdge)\r\n          ) {\r\n            self.props.onSwapEdge(sourceNode, hoveredNode, swapEdge);\r\n            self.renderView();\r\n          } else {\r\n            swapErrBack();\r\n          }\r\n        } else {\r\n          self.props.onCreateEdge(sourceNode, hoveredNode);\r\n          self.renderView();\r\n        }\r\n      } else {\r\n        if (swapErrBack) {\r\n          swapErrBack();\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  dragNode = () => {\r\n    const self = this;\r\n\r\n    const el = d3.select(d3.event.target.parentElement); // Enclosing 'g' element\r\n    el.classed('dragging', true);\r\n    d3.event.on('drag', dragged).on('end', ended);\r\n\r\n    let oldSibling = null;\r\n    function dragged(d) {\r\n      if (self.props.readOnly) return;\r\n      const selectedNode = d3.select(this);\r\n      if (!oldSibling) {\r\n        oldSibling = this.nextSibling;\r\n      }\r\n      // Moves child to the end of the element stack to re-arrange the z-index\r\n      this.parentElement.appendChild(this);\r\n\r\n      selectedNode.attr('transform', function(d) {\r\n        d.x += d3.event.dx;\r\n        d.y += d3.event.dy;\r\n        return 'translate(' + d.x + ',' + d.y + ')';\r\n      });\r\n      self.render();\r\n    }\r\n\r\n    function ended() {\r\n      el.classed('dragging', false);\r\n\r\n      if (!self.props.readOnly) {\r\n        var d = d3.select(this).datum();\r\n        // Move the node back to the original z-index\r\n        if (oldSibling) {\r\n          oldSibling.parentElement.insertBefore(this, oldSibling);\r\n        }\r\n        self.props.onUpdateNode(d);\r\n      }\r\n\r\n      // For some reason, mouseup isn't firing\r\n      // - manually firing it here\r\n      d3\r\n        .select(this)\r\n        .node()\r\n        .dispatchEvent(new Event('mouseup'));\r\n    }\r\n  };\r\n\r\n  // Node 'drag' handler\r\n  handleNodeDrag = () => {\r\n    if (this.state.drawingEdge && !this.props.readOnly) {\r\n      const target = { x: d3.event.subject.x, y: d3.event.subject.y };\r\n      this.drawEdge(d3.event.subject, target);\r\n    } else {\r\n      this.dragNode();\r\n    }\r\n  };\r\n\r\n  handleDelete = () => {\r\n    if (this.props.readOnly) return;\r\n    if (this.props.selected) {\r\n      const selected = this.props.selected;\r\n      if (!selected.source && this.props.canDeleteNode(selected)) {\r\n        this.props.onDeleteNode(selected);\r\n        this.props.onSelectNode(null);\r\n      } else if (selected.source && this.props.canDeleteEdge(selected)) {\r\n        this.props.onDeleteEdge(selected);\r\n        this.props.onSelectNode(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  handleWrapperKeydown = (d, i) => {\r\n    // Conditionally ignore keypress events on the window\r\n    // if the Graph isn't focused\r\n    switch (d3.event.key) {\r\n      case 'Delete':\r\n        this.handleDelete();\r\n        break;\r\n      case 'Backspace':\r\n        this.handleDelete();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n\r\n  handleSvgClicked = (d, i) => {\r\n    if (this.isPartOfEdge(d3.event.target)) return; // If any part of the edge is clicked, return\r\n\r\n    if (this.state.selectingNode) {\r\n      this.setState({\r\n        selectingNode: false,\r\n      });\r\n    } else {\r\n      this.props.onSelectNode(null);\r\n\r\n      if (!this.props.readOnly && d3.event.shiftKey) {\r\n        var xycoords = d3.mouse(event.target);\r\n        this.props.onCreateNode(xycoords[0], xycoords[1]);\r\n        this.renderView();\r\n      }\r\n    }\r\n  };\r\n\r\n  isPartOfEdge = (element) => {\r\n    while (element != null && element != this.viewWrapper) {\r\n      if (element.classList.contains('edge')) {\r\n        return true;\r\n      }\r\n      element = element.parentElement;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  handleNodeMouseDown = (d) => {\r\n    if (d3.event.defaultPrevented) {\r\n      return; // dragged\r\n    }\r\n\r\n    // Prevent d3's default as it changes the focus to the body\r\n    d3.event.preventDefault();\r\n    d3.event.stopPropagation();\r\n    if (document.activeElement != this.viewWrapper) {\r\n      this.viewWrapper.focus();\r\n    }\r\n\r\n    if (d3.event.shiftKey) {\r\n      this.setState({\r\n        selectingNode: true,\r\n        drawingEdge: true,\r\n      });\r\n    } else {\r\n      const previousSelection = this.state.previousSelection;\r\n      this.setState({\r\n        selectingNode: true,\r\n        selectedNode: d,\r\n        previousSelection,\r\n      });\r\n    }\r\n  };\r\n\r\n  handleNodeMouseUp = (d) => {\r\n    if (this.state.selectingNode) {\r\n      this.props.onSelectNode(d);\r\n      this.setState({\r\n        selectingNode: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  handleNodeMouseEnter = (d) => {\r\n    if (this.state.hoveredNode != d) {\r\n      this.setState({\r\n        hoveredNode: d,\r\n      });\r\n    }\r\n  };\r\n\r\n  handleNodeMouseLeave = (d) => {\r\n    // For whatever reason, mouseLeave is fired when edge dragging ends\r\n    // (and mouseup is not fired). This clears the hoverNode state prematurely\r\n    // resulting in swapEdge failing to fire.\r\n    // Detecting & ignoring mouseLeave events that result from drag ending here\r\n    const fromMouseup = event.which == 1;\r\n    if (this.state.hoveredNode === d && !fromMouseup) {\r\n      this.setState({\r\n        hoveredNode: null,\r\n      });\r\n    }\r\n  };\r\n\r\n  // One can't attach handlers to 'markers' or obtain them from the event.target\r\n  // If the click occurs within a certain radius of edge target,\r\n  // assume the click occurred on the arrow\r\n  arrowClicked = (d) => {\r\n    if (event.target.tagName != 'path') return false; // If the handle is clicked\r\n\r\n    const xycoords = d3.mouse(event.target);\r\n    const target = this.props.getViewNode(d.target);\r\n    const dist = getDistance({ x: xycoords[0], y: xycoords[1] }, target);\r\n\r\n    return dist < this.props.nodeSize / 2 + this.props.edgeArrowSize + 10; // or *2 or ^2?\r\n  };\r\n\r\n  handleEdgeDrag = (d) => {\r\n    if (!this.props.readOnly && this.state.drawingEdge) {\r\n      const edgeDOMNode = event.target.parentElement;\r\n      const sourceNode = this.props.getViewNode(d.source);\r\n      const xycoords = d3.mouse(event.target);\r\n      const target = { x: xycoords[0], y: xycoords[1] };\r\n\r\n      this.hideEdge(edgeDOMNode);\r\n      this.drawEdge(sourceNode, target, this.showEdge.bind(this, edgeDOMNode));\r\n    }\r\n  };\r\n\r\n  handleEdgeMouseDown = (d) => {\r\n    // Prevent d3's default as it changes the focus to the body\r\n    d3.event.preventDefault();\r\n    d3.event.stopPropagation();\r\n    if (document.activeElement != this.viewWrapper) {\r\n      this.viewWrapper.focus();\r\n    }\r\n\r\n    if (!this.props.readOnly && this.arrowClicked(d)) {\r\n      this.state.edgeSwapQueue.push(d); // Set this edge aside for redrawing\r\n      this.setState({\r\n        drawingEdge: true,\r\n        edgeSwapQueue: this.state.edgeSwapQueue,\r\n      });\r\n    } else {\r\n      this.props.onSelectEdge(d);\r\n    }\r\n  };\r\n\r\n  // Keeps 'zoom' contained\r\n  containZoom = () => {\r\n    d3.event.preventDefault();\r\n  };\r\n\r\n  // View 'zoom' handler\r\n  handleZoom = () => {\r\n    if (this.state.focused) {\r\n      this.setState({\r\n        viewTransform: d3.event.transform,\r\n      });\r\n    }\r\n  };\r\n\r\n  // Zooms to contents of this.refs.entities\r\n  handleZoomToFit = () => {\r\n    const parent = d3.select(this.viewWrapper).node();\r\n    const entities = d3.select(this.entities).node();\r\n\r\n    const viewBBox = entities.getBBox();\r\n\r\n    const width = parent.clientWidth;\r\n    const height = parent.clientHeight;\r\n\r\n    let dx,\r\n      dy,\r\n      x,\r\n      y,\r\n      translate = [this.state.viewTransform.x, this.state.viewTransform.y],\r\n      next = { x: translate[0], y: translate[1], k: this.state.viewTransform.k };\r\n\r\n    if (viewBBox.width > 0 && viewBBox.height > 0) {\r\n      // There are entities\r\n      (dx = viewBBox.width),\r\n        (dy = viewBBox.height),\r\n        (x = viewBBox.x + viewBBox.width / 2),\r\n        (y = viewBBox.y + viewBBox.height / 2);\r\n\r\n      next.k = 0.9 / Math.max(dx / width, dy / height);\r\n\r\n      if (next.k < this.props.minZoom) {\r\n        next.k = this.props.minZoom;\r\n      } else if (next.k > this.props.maxZoom) {\r\n        next.k = this.props.maxZoom;\r\n      }\r\n\r\n      next.x = width / 2 - next.k * x;\r\n      next.y = height / 2 - next.k * y;\r\n    } else {\r\n      next.k = (this.props.minZoom + this.props.maxZoom) / 2;\r\n      next.x = 0;\r\n      next.y = 0;\r\n    }\r\n\r\n    this.setZoom(next.k, next.x, next.y, this.props.zoomDur);\r\n  };\r\n\r\n  // Updates current viewTransform with some delta\r\n  modifyZoom = (modK = 0, modX = 0, modY = 0, dur = 0) => {\r\n    const parent = d3.select(this.viewWrapper).node();\r\n    const width = parent.clientWidth;\r\n    const height = parent.clientHeight;\r\n\r\n    let target_zoom,\r\n      center = [width / 2, height / 2],\r\n      extent = this.zoom.scaleExtent(),\r\n      translate = [this.state.viewTransform.x, this.state.viewTransform.y],\r\n      translate0 = [],\r\n      l = [],\r\n      next = { x: translate[0], y: translate[1], k: this.state.viewTransform.k };\r\n\r\n    target_zoom = next.k * (1 + modK);\r\n\r\n    if (target_zoom < extent[0] || target_zoom > extent[1]) {\r\n      return false;\r\n    }\r\n\r\n    translate0 = [(center[0] - next.x) / next.k, (center[1] - next.y) / next.k];\r\n    next.k = target_zoom;\r\n    l = [translate0[0] * next.k + next.x, translate0[1] * next.k + next.y];\r\n\r\n    next.x += center[0] - l[0] + modX;\r\n    next.y += center[1] - l[1] + modY;\r\n\r\n    this.setZoom(next.k, next.x, next.y, dur);\r\n  };\r\n\r\n  // Programmatically resets zoom\r\n  setZoom = (k = 1, x = 0, y = 0, dur = 0) => {\r\n    var t = d3.zoomIdentity.translate(x, y).scale(k);\r\n\r\n    d3\r\n      .select(this.viewWrapper)\r\n      .select('svg')\r\n      .transition()\r\n      .duration(dur)\r\n      .call(this.zoom.transform, t);\r\n  };\r\n\r\n  /*\r\n   * Render\r\n   */\r\n\r\n  // Returns the svg's path.d' (geometry description) string from edge data\r\n  // edge.source and edge.target are node ids\r\n  // @deprecated - not removed due to potential third party integrations\r\n  getPathDescriptionStr = (sourceX, sourceY, targetX, targetY) => {\r\n    return `M${sourceX},${sourceY}L${targetX},${targetY}`;\r\n  };\r\n\r\n  getPathDescription = (edge) => {\r\n    let src = this.props.getViewNode(edge.source);\r\n    let trg = this.props.getViewNode(edge.target);\r\n\r\n    if (src && trg) {\r\n      const off = this.props.nodeSize / 2; // from the center of the node to the perimeter\r\n\r\n      const theta = getTheta(src, trg);\r\n\r\n      const xOff = off * Math.cos(theta);\r\n      const yOff = off * Math.sin(theta);\r\n\r\n      return this.lineFunction([\r\n        { x: src.x + xOff, y: src.y + yOff },\r\n        { x: trg.x - xOff, y: trg.y - yOff },\r\n      ]);\r\n    }\r\n    console.warn('Unable to get source or target for ', edge);\r\n    return '';\r\n  };\r\n\r\n  getEdgeHandleTransformation = (edge) => {\r\n    let src = this.props.getViewNode(edge.source);\r\n    let trg = this.props.getViewNode(edge.target);\r\n\r\n    let origin = getMidpoint(src, trg);\r\n    let x = origin.x;\r\n    let y = origin.y;\r\n    let theta = getTheta(src, trg) * 180 / Math.PI;\r\n    let offset = -this.props.edgeHandleSize / 2;\r\n\r\n    return `translate(${x}, ${y}) rotate(${theta}) translate(${offset}, ${offset})`;\r\n  };\r\n\r\n  // Returns a d3 transformation string from node data\r\n  getNodeTransformation = (node) => {\r\n    return 'translate(' + node.x + ',' + node.y + ')';\r\n  };\r\n\r\n  getNodeStyle = (d, selected) => {\r\n    return d === selected\r\n      ? this.state.styles.node.selectedString\r\n      : this.state.styles.node.baseString;\r\n  };\r\n\r\n  getEdgeStyle = (d, selected) => {\r\n    return d === selected\r\n      ? this.state.styles.edge.selectedString\r\n      : this.state.styles.edge.baseString;\r\n  };\r\n\r\n  getTextStyle = (d, selected) => {\r\n    return d === selected\r\n      ? this.state.styles.text.selectedString\r\n      : this.state.styles.text.baseString;\r\n  };\r\n\r\n  wrap = (text, width) => {\r\n    console.log('inner text', text);\r\n    text.each(function() {\r\n      console.log('this', this);\r\n      var text = d3.select(this),\r\n        words = text\r\n          .text()\r\n          .split(/\\s+/)\r\n          .reverse(),\r\n        word,\r\n        line = [],\r\n        lineNumber = 0,\r\n        lineHeight = 1.1, // ems\r\n        x = text.attr('x'),\r\n        y = text.attr('y'),\r\n        dy = -0.5, //parseFloat(text.attr(\"dy\")),\r\n        tspan = text\r\n          .text(null)\r\n          .append('tspan')\r\n          .attr('x', x)\r\n          .attr('y', y)\r\n          .attr('dy', dy + 'em');\r\n      while ((word = words.pop())) {\r\n        line.push(word);\r\n        tspan.text(line.join(' '));\r\n        if (tspan.node().getComputedTextLength() > width) {\r\n          line.pop();\r\n          tspan.text(line.join(' '));\r\n          line = [word];\r\n          lineNumber += 1;\r\n          tspan = text\r\n            .append('tspan')\r\n            .attr('x', 0)\r\n            .attr('y', y)\r\n            .attr('dy', lineHeight + 'em')\r\n            .text(word);\r\n        }\r\n      }\r\n\r\n      if (lineNumber == 0) tspan.attr('dy', '0.5em');\r\n    });\r\n  };\r\n\r\n  // Renders 'node.title' into node element\r\n  renderNodeText = (d, domNode) => {\r\n    let d3Node = d3.select(domNode);\r\n\r\n    let title = d.title ? d.title : ' ';\r\n\r\n    let titleText =\r\n      title.length <= this.props.maxTitleChars\r\n        ? title\r\n        : `${title.substring(0, this.props.maxTitleChars)}...`;\r\n\r\n    d3Node.selectAll('text').remove();\r\n\r\n    let typeText = this.props.nodeTypes[d.type].typeText;\r\n    let style = this.getTextStyle(d, this.props.selected);\r\n\r\n    let el = d3Node\r\n      .append('text')\r\n      .attr('text-anchor', 'middle')\r\n      .attr('style', style)\r\n      .style('font-size', '15px');\r\n\r\n    if (title) {\r\n      el\r\n        .append('tspan')\r\n        .text(titleText)\r\n        .attr('x', 0);\r\n\r\n      //el.append('title').text(title);\r\n\r\n      el.call(this.wrap, 120);\r\n    }\r\n  };\r\n\r\n  // Renders 'edges' into entities element\r\n  renderEdges = (entities, edges) => {\r\n    var self = this;\r\n\r\n    // Join Data\r\n    var edges = entities.selectAll('g.edge').data(edges, function(d) {\r\n      // IMPORTANT: this snippet allows D3 to detect updated vs. new data\r\n      return `${d.source}:${d.target}`;\r\n    });\r\n\r\n    // Remove Old\r\n    edges.exit().remove();\r\n\r\n    // Add New\r\n    var newEdges = edges\r\n      .enter()\r\n      .append('g')\r\n      .classed('edge', true);\r\n\r\n    newEdges\r\n      .on('mousedown', this.handleEdgeMouseDown)\r\n      .call(d3.drag().on('start', this.handleEdgeDrag));\r\n\r\n    newEdges\r\n      .attr('opacity', 0)\r\n      .transition()\r\n      .duration(self.props.transitionTime)\r\n      .attr('opacity', 1);\r\n\r\n    // Merge\r\n    edges.enter().merge(edges);\r\n\r\n    function updateEdge(d, i, els) {\r\n      // setTimeout is used to unblock the browser\r\n      // clearing the previous render's timeout prevents the browser from being overworked\r\n      const key = `edgeKey-${d.source}_${d.target}`;\r\n      if (self.edgeTimeouts[key]) {\r\n        clearTimeout(self.edgeTimeouts[key]);\r\n      }\r\n      self.edgeTimeouts[key] = setTimeout(() => {\r\n        self.props.renderEdge(self, this, d, i, els);\r\n      });\r\n    }\r\n\r\n    // Update All\r\n    edges.each(updateEdge);\r\n  };\r\n\r\n  // Renders 'nodes' into entities element\r\n  renderNodes = (entities, nodes) => {\r\n    var self = this;\r\n    const nodeKey = this.props.nodeKey;\r\n    const parent = this.viewWrapper;\r\n    const viewTransform = this.state.viewTransform;\r\n    const overlap = 300 / viewTransform.k;\r\n\r\n    // Join Data\r\n    let nodeKeyWarned = false;\r\n    var nodesSelection = entities.selectAll('g.node').data(nodes, function(d) {\r\n      // IMPORTANT: this snippet allows D3 to detect updated vs. new data\r\n      if (d[nodeKey] === undefined && !nodeKeyWarned) {\r\n        console.warn(\r\n          `Warning: The specified nodeKey '${nodeKey}' cannot be found on a node. \\\r\n          Make sure the nodeKey is accurate and that all nodes contain a property called '${nodeKey}'. \\\r\n          Performance will degrade when there are nodes with an undefined nodeKey or with duplicate keys.`\r\n        );\r\n        nodeKeyWarned = true;\r\n      }\r\n      return d[nodeKey];\r\n    });\r\n\r\n    // Animate/Remove Old\r\n    var removedNodes = nodesSelection\r\n      .exit()\r\n      .transition()\r\n      .duration(self.props.transitionTime)\r\n      .attr('opacity', 0)\r\n      .remove();\r\n\r\n    // Add New\r\n    var newNodes = nodesSelection\r\n      .enter()\r\n      .append('g')\r\n      .classed('node', true);\r\n\r\n    newNodes\r\n      .on('mousedown', this.handleNodeMouseDown)\r\n      .on('mouseup', this.handleNodeMouseUp)\r\n      .on('click', (d) => {\r\n        // Force blocking propagation on node click.\r\n        // It was found that large graphs would handle clicks on the canvas even\r\n        // though the mouseDown event blocked propagation.\r\n        d3.event.stopPropagation();\r\n        d3.event.preventDefault();\r\n      })\r\n      .on('mouseenter', this.handleNodeMouseEnter)\r\n      .on('mouseleave', this.handleNodeMouseLeave)\r\n      .call(d3.drag().on('start', this.handleNodeDrag));\r\n\r\n    newNodes\r\n      .attr('opacity', 0)\r\n      .transition()\r\n      .duration(self.props.transitionTime)\r\n      .attr('opacity', 1);\r\n\r\n    // Merge\r\n    nodesSelection.enter().merge(nodesSelection);\r\n\r\n    function updateNode(d, i, els) {\r\n      const key = `nodeKey-${d[nodeKey]}`;\r\n      // setTimeout is used to unblock the browser\r\n      // clearing the previous render's timeout prevents the browser from being overworked\r\n      if (self.nodeTimeouts[key]) {\r\n        clearTimeout(self.nodeTimeouts[key]);\r\n      }\r\n      self.nodeTimeouts[key] = setTimeout(() => {\r\n        self.props.renderNode(self, this, d, i, els);\r\n      });\r\n    }\r\n\r\n    // Update Selected and Unselected\r\n    // New or Removed\r\n    const selected = nodesSelection.filter((d) => {\r\n      return d === this.props.selected || d === this.state.previousSelection;\r\n    });\r\n\r\n    /*\r\n      The commented code below would prevent nodes from rendering\r\n      until they are within the viewport. The problem is that this causes a zoom-to-fit\r\n      regression. The benefit from the code is that even a gigantic graph is very responsive at first,\r\n      however as a person zooms out or moves the graph around it would add more nodes.\r\n      After many nodes are added to the graph the zoom behavior will degrade, and there's no way to\r\n      remove the existing nodes from the DOM which are outside of the viewport. This degraded performance already\r\n      exists in the zoom-to-fit scenario for large graphs, since all nodes are rendered and never removed.\r\n      TODO: figure out if it's possible/worthwhile to remove nodes from the graph that are outside of the viewport\r\n      TODO: figure out the zoom-to-fit if this is added\r\n    */\r\n    // function viewableFilter(d) {\r\n    // const xPosition = (d.x + viewTransform.x) * viewTransform.k;\r\n    // const yPosition = (d.y + viewTransform.y) * viewTransform.k;\r\n    // return xPosition < parent.offsetWidth + overlap &&\r\n    //   xPosition > 0 - overlap &&\r\n    //   yPosition < parent.offsetHeight + overlap &&\r\n    //   yPosition > 0 - overlap;\r\n    // }\r\n    // selected.filter(viewableFilter).each(updateNode);\r\n    // removedNodes.filter(viewableFilter).each(updateNode);\r\n    // newNodes.filter(viewableFilter).each(updateNode);\r\n\r\n    selected.each(updateNode);\r\n    removedNodes.each(updateNode);\r\n    newNodes.each(updateNode);\r\n\r\n    const newState = {};\r\n\r\n    // Update all others\r\n    // Normally we would want to only render all others on a zoom change,\r\n    // however sometimes other nodes must be updated on a selection\r\n    nodesSelection\r\n      .filter((d) => {\r\n        const isInSelected = selected\r\n          .filter((sd) => {\r\n            return sd === d;\r\n          })\r\n          .size();\r\n        const isInNewNodes = newNodes\r\n          .filter((nd) => {\r\n            return nd === d;\r\n          })\r\n          .size();\r\n        const isInRemovedNodes = removedNodes\r\n          .filter((rd) => {\r\n            return rd === d;\r\n          })\r\n          .size();\r\n\r\n        return (\r\n          // viewableFilter(d) && // see comment above\r\n          !isInSelected && !isInNewNodes && !isInRemovedNodes\r\n        );\r\n      })\r\n      .each(updateNode);\r\n  };\r\n\r\n  // Renders 'graph' into view element\r\n  // All DOM updates within 'view' are managed by D3\r\n  renderView = () => {\r\n    var nodes = this.props.nodes;\r\n    var edges = this.props.edges;\r\n\r\n    // Update the view w/ new zoom/pan\r\n    const view = d3.select(this.view).attr('transform', this.state.viewTransform);\r\n\r\n    const entities = d3.select(this.entities);\r\n\r\n    this.renderNodes(entities, nodes);\r\n    this.renderEdges(entities, edges);\r\n  };\r\n\r\n  render() {\r\n    this.renderView();\r\n    const { styles, focused } = this.state;\r\n    return (\r\n      <div\r\n        className=\"viewWrapper\"\r\n        tabIndex={0}\r\n        onFocus={() => {\r\n          this.setState({\r\n            focused: true,\r\n          });\r\n        }}\r\n        onBlur={() => {\r\n          if (this.props.enableFocus) {\r\n            this.setState({\r\n              focused: false,\r\n            });\r\n          }\r\n        }}\r\n        ref={(el) => (this.viewWrapper = el)}\r\n        style={[styles.wrapper.base, !!focused && styles.wrapper.focused, this.props.style]}\r\n      >\r\n        <svg style={styles.svg.base}>\r\n          {this.props.renderDefs(this)}\r\n          <g className=\"view\" ref={(el) => (this.view = el)}>\r\n            {this.props.renderBackground(this)}\r\n            <g className=\"entities\" ref={(el) => (this.entities = el)} />\r\n          </g>\r\n        </svg>\r\n        {this.props.graphControls && (\r\n          <GraphControls\r\n            primary={this.props.primary}\r\n            minZoom={this.props.minZoom}\r\n            maxZoom={this.props.maxZoom}\r\n            zoomLevel={this.state.viewTransform.k}\r\n            zoomToFit={this.handleZoomToFit}\r\n            modifyZoom={this.modifyZoom}\r\n          />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nGraphView.propTypes = {\r\n  nodeKey: PropTypes.string.isRequired,\r\n  emptyType: PropTypes.string.isRequired,\r\n  nodes: PropTypes.array.isRequired,\r\n  edges: PropTypes.array.isRequired,\r\n  selected: PropTypes.object.isRequired,\r\n  nodeTypes: PropTypes.object.isRequired,\r\n  nodeSubtypes: PropTypes.object.isRequired,\r\n  edgeTypes: PropTypes.object.isRequired,\r\n  getViewNode: PropTypes.func.isRequired,\r\n  onSelectNode: PropTypes.func.isRequired,\r\n  onCreateNode: PropTypes.func.isRequired,\r\n  onUpdateNode: PropTypes.func.isRequired,\r\n  onDeleteNode: PropTypes.func.isRequired,\r\n  onSelectEdge: PropTypes.func.isRequired,\r\n  onCreateEdge: PropTypes.func.isRequired,\r\n  onSwapEdge: PropTypes.func.isRequired,\r\n  onDeleteEdge: PropTypes.func.isRequired,\r\n  canDeleteNode: PropTypes.func,\r\n  canCreateEdge: PropTypes.func,\r\n  canDeleteEdge: PropTypes.func,\r\n  renderEdge: PropTypes.func,\r\n  renderNode: PropTypes.func,\r\n  renderDefs: PropTypes.func,\r\n  renderBackground: PropTypes.func,\r\n  readOnly: PropTypes.bool,\r\n  enableFocus: PropTypes.bool,\r\n  maxTitleChars: PropTypes.number, // Per line.\r\n  transitionTime: PropTypes.number, // D3 Enter/Exit duration\r\n  primary: PropTypes.string,\r\n  light: PropTypes.string,\r\n  dark: PropTypes.string,\r\n  background: PropTypes.string,\r\n  style: PropTypes.object,\r\n  gridSize: PropTypes.number, // The point grid is fixed\r\n  gridSpacing: PropTypes.number,\r\n  gridDot: PropTypes.number,\r\n  minZoom: PropTypes.number,\r\n  maxZoom: PropTypes.number,\r\n  nodeSize: PropTypes.number,\r\n  edgeHandleSize: PropTypes.number,\r\n  edgeArrowSize: PropTypes.number,\r\n  zoomDelay: PropTypes.number, // ms\r\n  zoomDur: PropTypes.number, // ms\r\n  graphControls: PropTypes.bool,\r\n};\r\n\r\nGraphView.defaultProps = {\r\n  readOnly: false,\r\n  maxTitleChars: 9,\r\n  transitionTime: 150,\r\n  primary: 'dodgerblue',\r\n  light: '#FFF',\r\n  dark: '#000',\r\n  background: '#F9F9F9',\r\n  gridSize: 40960, // The point grid is fixed\r\n  gridSpacing: 36,\r\n  gridDot: 2,\r\n  minZoom: 0.15,\r\n  maxZoom: 1.5,\r\n  nodeSize: 150,\r\n  edgeHandleSize: 50,\r\n  edgeArrowSize: 8,\r\n  zoomDelay: 500,\r\n  zoomDur: 750,\r\n  graphControls: true,\r\n  renderEdge: (graphView, domNode, datum, index, elements) => {\r\n    // For new edges, add necessary child domNodes\r\n    if (!domNode.hasChildNodes()) {\r\n      d3.select(domNode).append('path');\r\n      d3.select(domNode).append('use');\r\n    }\r\n\r\n    let style = graphView.getEdgeStyle(datum, graphView.props.selected);\r\n    let trans = graphView.getEdgeHandleTransformation(datum);\r\n    d3\r\n      .select(domNode)\r\n      .attr('style', style)\r\n      .select('use')\r\n      .attr('xlink:href', function(d) {\r\n        return graphView.props.edgeTypes[d.type].shapeId;\r\n      })\r\n      .attr('width', graphView.props.edgeHandleSize)\r\n      .attr('height', graphView.props.edgeHandleSize)\r\n      .attr('transform', trans);\r\n\r\n    d3\r\n      .select(domNode)\r\n      .select('path')\r\n      .attr('d', graphView.getPathDescription);\r\n  },\r\n  renderNode: (graphView, domNode, datum, index, elements) => {\r\n    // For new nodes, add necessary child domNodes\r\n    const selection = d3.select(domNode);\r\n    if (!domNode.hasChildNodes()) {\r\n      selection\r\n        .append('use')\r\n        .classed('subtypeShape', true)\r\n        .attr('x', -graphView.props.nodeSize / 2)\r\n        .attr('y', -graphView.props.nodeSize / 2)\r\n        .attr('width', graphView.props.nodeSize)\r\n        .attr('height', graphView.props.nodeSize);\r\n      selection\r\n        .append('use')\r\n        .classed('shape', true)\r\n        .attr('x', -graphView.props.nodeSize / 2)\r\n        .attr('y', -graphView.props.nodeSize / 2)\r\n        .attr('width', graphView.props.nodeSize)\r\n        .attr('height', graphView.props.nodeSize);\r\n    }\r\n\r\n    let style = graphView.getNodeStyle(datum, graphView.props.selected);\r\n\r\n    selection.attr('style', style);\r\n\r\n    if (datum.subtype) {\r\n      selection.select('use.subtypeShape').attr('xlink:href', function(d) {\r\n        return graphView.props.nodeSubtypes[d.subtype].shapeId;\r\n      });\r\n    } else {\r\n      selection.select('use.subtypeShape').attr('xlink:href', function(d) {\r\n        return null;\r\n      });\r\n    }\r\n\r\n    selection.select('use.shape').attr('xlink:href', function(d) {\r\n      return graphView.props.nodeTypes[d.type].shapeId;\r\n    });\r\n\r\n    selection.attr('id', `node-${datum[graphView.props.nodeKey]}`);\r\n\r\n    graphView.renderNodeText(datum, domNode);\r\n\r\n    selection.attr('transform', graphView.getNodeTransformation);\r\n  },\r\n  renderDefs: (graphView) => {\r\n    const { styles } = graphView.state;\r\n    const {\r\n      edgeArrowSize,\r\n      gridSpacing,\r\n      gridDot,\r\n      nodeTypes,\r\n      nodeSubtypes,\r\n      edgeTypes,\r\n    } = graphView.props;\r\n\r\n    let defIndex = 0;\r\n    let graphConfigDefs = [];\r\n\r\n    Object.keys(nodeTypes).forEach(function(type) {\r\n      defIndex += 1;\r\n      graphConfigDefs.push(React.cloneElement(nodeTypes[type].shape, { key: defIndex }));\r\n    });\r\n\r\n    Object.keys(nodeSubtypes).forEach(function(type) {\r\n      defIndex += 1;\r\n      graphConfigDefs.push(React.cloneElement(nodeSubtypes[type].shape, { key: defIndex }));\r\n    });\r\n\r\n    Object.keys(edgeTypes).forEach(function(type) {\r\n      defIndex += 1;\r\n      graphConfigDefs.push(React.cloneElement(edgeTypes[type].shape, { key: defIndex }));\r\n    });\r\n\r\n    return (\r\n      <defs>\r\n        {graphConfigDefs}\r\n\r\n        <marker\r\n          id=\"end-arrow\"\r\n          key=\"end-arrow\"\r\n          viewBox={`0 -${edgeArrowSize / 2} ${edgeArrowSize} ${edgeArrowSize}`}\r\n          refX={`${edgeArrowSize / 2}`}\r\n          markerWidth={`${edgeArrowSize}`}\r\n          markerHeight={`${edgeArrowSize}`}\r\n          orient=\"auto\"\r\n        >\r\n          <path\r\n            style={styles.arrow}\r\n            d={`M0,-${edgeArrowSize / 2}L${edgeArrowSize},0L0,${edgeArrowSize / 2}`}\r\n          />\r\n        </marker>\r\n\r\n        <pattern\r\n          id=\"grid\"\r\n          key=\"grid\"\r\n          width={gridSpacing}\r\n          height={gridSpacing}\r\n          patternUnits=\"userSpaceOnUse\"\r\n        >\r\n          <circle cx={gridSpacing / 2} cy={gridSpacing / 2} r={gridDot} fill=\"lightgray\" />\r\n        </pattern>\r\n\r\n        <filter id=\"dropshadow\" key=\"dropshadow\" height=\"130%\">\r\n          <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"3\" />\r\n          <feOffset dx=\"2\" dy=\"2\" result=\"offsetblur\" />\r\n          <feComponentTransfer>\r\n            <feFuncA type=\"linear\" slope=\"0.1\" />\r\n          </feComponentTransfer>\r\n          <feMerge>\r\n            <feMergeNode />\r\n            <feMergeNode in=\"SourceGraphic\" />\r\n          </feMerge>\r\n        </filter>\r\n      </defs>\r\n    );\r\n  },\r\n  renderBackground: (graphView) => {\r\n    return (\r\n      <rect\r\n        className=\"background\"\r\n        x={-graphView.props.gridSize / 4}\r\n        y={-graphView.props.gridSize / 4}\r\n        width={graphView.props.gridSize}\r\n        height={graphView.props.gridSize}\r\n        fill=\"url(#grid)\"\r\n      />\r\n    );\r\n  },\r\n  canDeleteNode: () => true,\r\n  canCreateEdge: () => true,\r\n  canDeleteEdge: () => true,\r\n};\r\n\r\nexport default Radium(GraphView);\r\n"]}